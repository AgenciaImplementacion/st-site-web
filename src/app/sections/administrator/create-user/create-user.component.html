<div class="app-body">
  <app-page-header [heading]="'Registrar usuarios'" [icon]="'fa-star'">
  </app-page-header>

  <main class="main d-flex align-items-center">
    <div class="container">
      <div class="row">
        <div class="col-md-8 mx-auto">
          <div class="card-group">
            <div class="card">
              <div class="card-header text-center">
                <h1 class="text-center mb-2">Registro de Usuarios</h1>
                <h3 class="text-center mb-2" *ngIf="roleConnect.id === 5">
                  Administrador del Sistema
                </h3>
                <h3 class="text-center mb-2" *ngIf="roleConnect.id === 1">
                  Perfil Administrador
                </h3>
                <h3 class="text-center mb-2" *ngIf="roleConnect.id === 2">
                  Gestor
                </h3>
                <h3 class="text-center mb-2" *ngIf="roleConnect.id === 4">
                  Proveedor
                </h3>
              </div>
              <div class="card-body">
                <form #formulariologin="ngForm">
                  <p class="text-muted">Ingrese los siguientes datos.</p>
                  <app-input
                    [id]="'firstName'"
                    [icon]="'perm_identity'"
                    [type]="'text'"
                    [name]="'firstName'"
                    [placeholder]="'Nombres'"
                    [(inputModel)]="registerData.firstName"
                    (change)="validfield()"
                  >
                  </app-input>
                  <app-input
                    [id]="'lastName'"
                    [icon]="'list_alt'"
                    [type]="'text'"
                    [name]="'lastName'"
                    [placeholder]="'Apellidos'"
                    [(inputModel)]="registerData.lastName"
                    (change)="validfield()"
                  >
                  </app-input>
                  <app-input
                    [id]="'username'"
                    [icon]="'account_circle'"
                    [type]="'text'"
                    [name]="'username'"
                    [placeholder]="'Nombre de usuario'"
                    [(inputModel)]="registerData.username"
                    (change)="validfield()"
                  >
                  </app-input>
                  <app-input
                    [id]="'email'"
                    [icon]="'email'"
                    [type]="'email'"
                    [name]="'email'"
                    [placeholder]="'Correo electrónico'"
                    [(inputModel)]="registerData.email"
                    (change)="validfield()"
                  >
                  </app-input>
                  <app-input
                    [id]="'password'"
                    [icon]="'security'"
                    [type]="'password'"
                    [name]="'password'"
                    [placeholder]="'Contraseña'"
                    [(inputModel)]="registerData.password"
                    (change)="validfield()"
                  >
                  </app-input>
                  <app-input
                    [id]="'confirmationPassword'"
                    [icon]="'lock'"
                    [type]="'password'"
                    [name]="'confirmationPassword'"
                    [placeholder]="'Confirmar contraseña'"
                    [(inputModel)]="registerData.confirmationPassword"
                    (change)="validfield()"
                  >
                  </app-input>
                  <small
                    *ngIf="roleConnect.id === 1"
                    id="perfil"
                    class="form-text text-muted mb-3"
                  >
                    Seleccione el rol que tendrá el usuario.
                  </small>
                  <fieldset
                    class="form-group text-center"
                    *ngIf="roleConnect.id === 1"
                  >
                    <label
                      class="radio-inline col-12 col-sm-3"
                      *ngFor="let item of registerData.state; let i = index"
                    >
                      <input
                        (change)="validfield()"
                        [(ngModel)]="selectROL"
                        [value]="item.id"
                        [id]="item.id"
                        name="roles"
                        type="radio"
                      />
                      {{ item.name }}
                    </label>
                  </fieldset>
                  <fieldset
                    class="form-group text-center"
                    *ngIf="dataUserLogger.is_provider_director"
                  >
                    <label
                      class="radio-inline col-12 col-sm-3"
                      *ngFor="let item of registerData.state; let i = index"
                    >
                      <input
                        (change)="validfield()"
                        [(ngModel)]="selectROL"
                        [value]="item.id"
                        [id]="item.id"
                        name="roles"
                        type="radio"
                      />
                      {{ item.name }}
                    </label>
                  </fieldset>
                  <div class="mb-3" *ngIf="selectROL === 2">
                    <div class="input-group" *ngIf="roleConnect.id === 1">
                      <div class="input-group-prepend">
                        <label class="input-group-text" aria-required="true"
                          >* Gestor</label
                        >
                      </div>
                      <select
                        (change)="getProfilesManager()"
                        class="custom-select"
                        name="managers"
                        id="managers"
                        [(ngModel)]="registerData.roleManager.managerId"
                      >
                        <option value="0" selected [disabled]="true">
                          Seleccione entidad
                        </option>
                        <option
                          [ngValue]="item.id"
                          *ngFor="let item of managers"
                        >
                          {{ item.alias }}
                        </option>
                      </select>
                    </div>
                    <div
                      class="input-group mt-2"
                      *ngIf="dataUserLogger.is_manager_director"
                    >
                      <div class="input-group-prepend">
                        <label class="input-group-text" aria-required="true"
                          >* Perfil</label
                        >
                      </div>
                      <select
                        (change)="validfield()"
                        class="custom-select"
                        name="managersprfile"
                        id="managersprofile"
                        [(ngModel)]="registerData.roleManager.profiles"
                        multiple
                      >
                        <option
                          [ngValue]="item.id"
                          *ngFor="let item of profilesManagers"
                        >
                          {{ item.name }}
                        </option>
                      </select>
                    </div>
                  </div>
                  <div class="mb-3" *ngIf="selectROL === 3">
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <label class="input-group-text" aria-required="true"
                          >* Operador</label
                        >
                      </div>
                      <select
                        (change)="validfield()"
                        class="custom-select"
                        name="operator"
                        id="operator"
                        [(ngModel)]="registerData.roleOperator.operatorId"
                      >
                        <option value="0" selected [disabled]="true">
                          Seleccione entidad
                        </option>
                        <option
                          [ngValue]="item.id"
                          *ngFor="let item of operators"
                        >
                          {{ item.alias }}
                        </option>
                      </select>
                    </div>
                  </div>
                  <div class="mb-3" *ngIf="selectROL === 4">
                    <div class="input-group" *ngIf="roleConnect.id === 1">
                      <div class="input-group-prepend">
                        <label class="input-group-text" aria-required="true"
                          >* Proveedor</label
                        >
                      </div>
                      <select
                        (change)="
                          getProfilesProviders(
                            registerData.roleProvider.providerId
                          )
                        "
                        class="custom-select"
                        name="providers"
                        id="providers"
                        [(ngModel)]="registerData.roleProvider.providerId"
                      >
                        <option value="0" selected [disabled]="true">
                          Seleccione entidad
                        </option>
                        <option
                          [ngValue]="item.id"
                          *ngFor="let item of providers"
                        >
                          {{ item.alias }}
                        </option>
                      </select>
                    </div>
                    <div
                      class="input-group mt-2"
                      *ngIf="dataUserLogger.is_provider_director"
                    >
                      <div class="input-group-prepend">
                        <label class="input-group-text" aria-required="true"
                          >* Areá de trabajo</label
                        >
                      </div>
                      <select
                        (change)="validfield()"
                        class="custom-select"
                        name="profilesProviders"
                        id="profilesProviders"
                        [(ngModel)]="registerData.roleProvider.profiles"
                        multiple
                      >
                        <option
                          [ngValue]="item.id"
                          *ngFor="let item of profilesProviders"
                        >
                          {{ item.name }}
                        </option>
                      </select>
                    </div>
                    <small
                      *ngIf="dataUserLogger.is_provider_director"
                      id="entities"
                      class="form-text text-muted"
                      >Seleccione el área o áreas de trabajo al que se vinculará
                      el usuario.</small
                    >
                  </div>
                  <div class="mb-3" *ngIf="selectROL === 5">
                    <small
                      *ngIf="dataUserLogger.is_provider_director"
                      id="entities"
                      class="form-text text-muted"
                    >
                      <b>Generador PDF:</b> Este usuario revisará y agregará los
                      archivos soporte, para cabida y linderos en el archivo
                      XTF.
                    </small>
                  </div>
                </form>
              </div>
              <div class="card-footer text-muted text-center">
                <button
                  type="button"
                  class="btn btn-dark px-4"
                  [disabled]="botonRegistrar"
                  (click)="openModal(modalRegistrar)"
                >
                  Registrar
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
  <ng-template #modalRegistrar let-modal>
    <div class="modal-header">
      <h4 class="modal-title">Registro de Usuarios</h4>
      <button
        type="button"
        class="close"
        aria-label="Close"
        (click)="modal.dismiss('Cross click')"
      >
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <h2 class="text-center font-weight-bold">
        ¿Está seguro de registrar el usuario?
      </h2>
      <h5 class="alert alert-warning text-center">
        Advertencia: Esta acción registra un usuario en el sistema.
      </h5>
    </div>
    <div class="modal-footer">
      <div class="col-6">
        <button
          type="button"
          class="btn btn-dark btn-block"
          (click)="closeModal(false)"
        >
          No
        </button>
      </div>
      <div class="col-6 text-right">
        <button
          type="button"
          ngbAutofocus
          class="btn btn-success btn-block"
          (click)="closeModal(true)"
        >
          Si
        </button>
      </div>
    </div>
  </ng-template>
</div>
